package ia;

import tablero.Casilla;
import tablero.Tablero;
import fantasmas.Fantasma;

public class ACasa implements Comportamiento {
	Fantasma f;
	Tablero t;
	
	/* Agilizar calculos */
	int[][] tabla = 
			{{99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99},
			{99,23,22,21,20,19,18,19,20,21,20,19,18,99,99,18,19,20,21,20,19,18,19,20,21,22,23,99},
			{99,22,99,99,99,99,17,99,99,99,99,99,17,99,99,17,99,99,99,99,99,17,99,99,99,99,22,99},
			{99,21,99,99,99,99,16,99,99,99,99,99,16,99,99,16,99,99,99,99,99,16,99,99,99,99,21,99},
			{99,20,99,99,99,99,15,99,99,99,99,99,15,99,99,15,99,99,99,99,99,15,99,99,99,99,20,99},
			{99,19,18,17,16,15,14,13,12,11,12,13,14,15,15,14,13,12,11,12,13,14,15,16,17,18,19,99},
			{99,20,99,99,99,99,15,99,99,10,99,99,99,99,99,99,99,99,10,99,99,15,99,99,99,99,20,99},
			{99,21,99,99,99,99,16,99,99,9,99,99,99,99,99,99,99,99,9,99,99,16,99,99,99,99,21,99},
			{99,22,21,20,19,18,17,99,99,8,7,6,5,99,99,5,6,7,8,99,99,17,18,19,20,21,22,99},
			{99,99,99,99,99,99,16,99,99,99,99,99,4,99,99,4,99,99,99,99,99,16,99,99,99,99,99,99},
			{99,99,99,99,99,99,15,99,99,99,99,99,3,99,99,3,99,99,99,99,99,15,99,99,99,99,99,99},
			{99,99,99,99,99,99,14,99,99,5,4,3,2,1,1,2,3,4,5,99,99,14,99,99,99,99,99,99},
			{99,99,99,99,99,99,13,99,99,6,99,99,99,0,0,99,99,99,6,99,99,13,99,99,99,99,99,99},
			{99,99,99,99,99,99,12,99,99,7,99,99,99,-1,-1,99,99,99,7,99,99,12,99,99,99,99,99,99},
			{17,16,15,14,13,12,11,10,9,8,99,99,99,99,-2,-1,99,99,8,9,10,11,12,13,14,15,16,17},
			{99,99,99,99,99,99,12,99,99,9,99,99,99,99,99,99,99,99,9,99,99,12,99,99,99,99,99,99},
			{99,99,99,99,99,99,13,99,99,10,99,99,99,99,99,99,99,99,10,99,99,13,99,99,99,99,99,99},
			{99,99,99,99,99,99,14,99,99,11,12,13,14,15,15,14,13,12,11,99,99,14,99,99,99,99,99,99},
			{99,99,99,99,99,99,15,99,99,12,99,99,99,99,99,99,99,99,12,99,99,15,99,99,99,99,99,99},
			{99,99,99,99,99,99,16,99,99,13,99,99,99,99,99,99,99,99,13,99,99,16,99,99,99,99,99,99},
			{99,22,21,20,19,18,17,16,15,14,15,16,17,99,99,17,16,15,14,15,16,17,18,19,20,21,22,99},
			{99,23,99,99,99,99,18,99,99,99,99,99,18,99,99,18,99,99,99,99,99,18,99,99,99,99,23,99},
			{99,24,99,99,99,99,19,99,99,99,99,99,19,99,99,19,99,99,99,99,99,19,99,99,99,99,24,99},
			{99,25,26,27,99,99,20,21,22,23,22,21,20,21,21,20,21,22,23,22,21,20,99,99,27,26,25,99},
			{99,99,99,28,99,99,21,99,99,24,99,99,99,99,99,99,99,99,24,99,99,21,99,99,28,99,99,99},
			{99,99,99,27,99,99,22,99,99,25,99,99,99,99,99,99,99,99,25,99,99,22,99,99,27,99,99,99},
			{99,28,27,26,25,24,23,99,99,26,27,28,29,99,99,29,28,27,26,99,99,23,24,25,26,27,28,99},
			{99,29,99,99,99,99,99,99,99,99,99,99,30,99,99,30,99,99,99,99,99,99,99,99,99,99,29,99},
			{99,30,99,99,99,99,99,99,99,99,99,99,31,99,99,31,99,99,99,99,99,99,99,99,99,99,30,99},
			{99,31,32,33,34,35,36,37,36,35,34,33,32,33,33,32,33,34,35,36,37,36,35,34,33,32,31,99},
			{99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99}};

	public void sigMovimiento(Tablero tablero, Fantasma fantasma) {
		Casilla actual = tablero.miCasilla(fantasma);
		Casilla[] vecinos = new Casilla[4];
		int menor = -1;
		int minimo = Integer.MAX_VALUE;
		int aux;
		f = fantasma;
		t = tablero;
		
		//System.out.println("Casilla: "+actual);
		//System.out.println("Tabla: "+tabla.length+", "+tabla[0].length);
		
		for(int i = 0; i < 4; i++){
			vecinos[i] = actual.getVecino(i);
			if(vecinos[i] != null){
				aux = heuristica(vecinos[i]);
				if(aux < minimo){
					minimo = aux;
					menor = i;
				}
			}
		}
		
		//System.out.println("H: "+minimo+"; Direccion: "+menor);
		
		switch(menor){
		case Casilla.IZQ:
			fantasma.setHorizontalMovement(tablero, -1);
			break;
		case Casilla.DER:
			fantasma.setHorizontalMovement(tablero, 1);
			break;
		case Casilla.ARR:
			fantasma.setVerticalMovement(tablero, -1);
			break;
		case Casilla.ABA:
			fantasma.setVerticalMovement(tablero, 1);
			break;
		default:
			break;
		}
	}
	
	/* Heuristica
	 * Tabla cargada con las distancias en el tablero ;)
	 * 
	 * Elegir la menor
	 */
	private int heuristica(Casilla actual){
		int fila = t.PixelYToPos(actual.getY());
		int col = t.PixelXToPos(actual.getX());
		int valor = tabla[fila][col];
		
		if(valor == -2){
			f.revivir();
		}
		return valor;
	}
	
	public String toString(){
		return "ACasa: "+f;
	}

}
